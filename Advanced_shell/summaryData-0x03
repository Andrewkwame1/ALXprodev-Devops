#!/bin/bash

# Task 3: Summarize Pokémon Data
# Objective: Create a report that summarizes data for multiple Pokémon

DATA_DIR="pokemon_data"
REPORT_FILE="pokemon_report.csv"

# Check if data directory exists
if [ ! -d "$DATA_DIR" ]; then
    echo "Error: $DATA_DIR not found. Please run Task 2 first."
    exit 1
fi

# Initialize CSV file with header
echo "Name,Height (m),Weight (kg)" > "$REPORT_FILE"

# Initialize variables for averages
total_height=0
total_weight=0
count=0

# Process each JSON file
for json_file in "$DATA_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        # Extract data using jq
        name=$(jq -r '.name' "$json_file")
        height=$(jq -r '.height' "$json_file")
        weight=$(jq -r '.weight' "$json_file")
        
        # Convert units
        height_m=$(echo "scale=2; $height / 10" | bc)
        weight_kg=$(echo "scale=2; $weight / 10" | bc)
        
        # Add to CSV
        echo "${name^},$height_m,$weight_kg" >> "$REPORT_FILE"
        
        # Accumulate for averages
        total_height=$(echo "scale=2; $total_height + $height_m" | bc)
        total_weight=$(echo "scale=2; $total_weight + $weight_kg" | bc)
        count=$((count + 1))
    fi
done

# Calculate averages using awk for precision
avg_height=$(echo "scale=2; $total_height / $count" | bc)
avg_weight=$(echo "scale=2; $total_weight / $count" | bc)

# Display results
echo "CSV Report generated at: $REPORT_FILE"
echo ""
cat "$REPORT_FILE"
echo ""
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
