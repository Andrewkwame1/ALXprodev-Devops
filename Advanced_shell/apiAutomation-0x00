#!/bin/bash

# Task 0: API Request Automation
# Objective: Automate the process of making API requests to the Pokémon API

# Set the Pokémon name
POKEMON="pikachu"
API_URL="https://pokeapi.co/api/v2/pokemon/${POKEMON}"
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

# Make the API request and handle errors
response=$(curl -s -w "%{http_code}" "$API_URL")

# Extract HTTP status code (last 3 characters)
http_code="${response: -3}"

# Extract response body (all but last 3 characters)
response_body="${response%???}"

# Check if request was successful (HTTP 200)
if [ "$http_code" -eq 200 ]; then
    # Save successful response to data.json
    echo "$response_body" > "$OUTPUT_FILE"
    echo "Successfully retrieved data for $POKEMON and saved to $OUTPUT_FILE"
else
    # Log error to errors.txt
    error_message="$(date): Failed to fetch data for $POKEMON. HTTP Status: $http_code"
    echo "$error_message" >> "$ERROR_FILE"
    echo "Error: $error_message"
    exit 1
fi
